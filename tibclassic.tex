\input tibex
%
\parindent=0pt
\newbox\pghdr
\TibHeaderBox=\pghdr
\setbox\pghdr=\hbox{\SamChe ༄༅\kern.01pt།\hskip2.7em plus .5em minus.5em།}
%
\def\orotate#1{\setbox0=\hbox{#1}%
  \special{x:gsave}\special{x:rotate 270}%
  \box0 \special{x:grestore}}
%
\NoInterLetterSkip
%
\newdimen\dimn%計算hoffset要用的臨時變量
\def\setpaperhalfa#1%設置紙張大小，半A4/三分之一A3
{\ifnum#1=4 %Half A4 paper
   \pdfpageheight90mm\pdfpagewidth297mm%
   \vsize=55mm\hsize=225mm%
   \voffset=-8mm
\else%
   \ifnum#1=3 %One third A3 paper
       \pdfpageheight99mm\pdfpagewidth420mm%
       \vsize=66mm\hsize=348mm%
       \voffset=-8mm
   \fi%
\fi
\dimn=\pdfpagewidth \advance\dimn by -\hsize
\advance\dimn by -28mm
\divide\dimn by 2
\advance\dimn by -11mm
\hoffset=\dimn
}
\setpaperhalfa4%缺省的將紙張設爲半A4
%
\maxdepth=0pt
\nopagenumbers
% 這些與字體相關，應該定義一個宏讓用戶自己設缺省行高
\baselineskip=10.5mm plus1mm
\lineskip=0mm plus1mm
\lineskiplimit=0.2mm
%
\parskip=0pt
\parfillskip=0pt
%
\newdimen\pagewidth \newdimen\pageheight \newdimen\ruleht%
\newdimen\halfpageht \newdimen\amiddle 
% 變量初始化宏，在\output裡調用
\def\setpagesize{%
\pagewidth=\hsize \pageheight=\vsize \ruleht=1pt%
\halfpageht=\pageheight \divide\halfpageht by 2%
\advance\halfpageht by .3pc
\advance\pagewidth by 10pt%
\advance\pageheight by 10pt\advance\pageheight by \maxdepth%
}%
%
\newcount\totalpages
% 左頁眉
\def\pgnuma{\vbox to 0pt{
  \kern -6pt \hrule height \ruleht
  \amiddle=\halfpageht \advance\amiddle by 2pc
  \hbox to3pc{\vrule height \pageheight width \ruleht
     \kern 21pt\raise\amiddle\hbox{\rlap{
        \orotate{
           \ifodd\pageno
              \ifnum\pageno>0
                  \m=\pageno \advance\m by 1 \divide\m by 2
                  \Sam\tibnumber\m
                  \m=\pageno \advance\m by 1 \divide\m by 2
                  \n=\totalpages \advance\n by 1 \divide\n by 2
                  \ifnum\m=\n ་བྱོན། \fi
                  %\hfill བརྟན།
              \fi
           \else
              \ifnum\pageno=2 \Sam \tibnumber 1\fi
           \fi
        }}}
     \hss\vrule width \ruleht}
  \hrule height \ruleht \vss
}}
%
\font\bigrm=cmr10 scaled\magstep2
%右頁眉
\def\pgnumb{\vbox to 0pt{
  \kern -6pt
  \hrule height \ruleht
  \hbox to3pc{\vrule height \pageheight width \ruleht
        \raise\halfpageht\hbox to 33pt{\hfil\bigrm \number\pageno\hfil}
     \hss\vrule width \ruleht}
%\advance\pageno by 1
  \hrule height \ruleht \vss
}}
%\hbox to 3pc{\vbox to\pageheight{
%\hrule\hbox to 35pt{\vrule\vbox to 179pt
%{\vss T1\vss}}}}
% 控制是否顯示邊框及頁眉
\newif\ifframe
\framefalse
%
\def\onepageout#1{\shipout\vbox{ % here we define one page of output
\setpagesize
\offinterlineskip % butt the boxes together
\ifframe
    \kern -9pt
    \moveright -5pt\vbox{\hrule width \pagewidth height 1pt}
    \kern 5pt
    \rlap{\kern-3pc\kern-5pt\vbox {\pgnuma}}
    \rlap{\kern\hsize\kern5pt\vbox {\pgnumb}}
\fi
\vbox to \vsize{
  #1 % now insert the main information
  \boxmaxdepth=\maxdepth
} % this completes the \vbox to \pageheight
\ifframe
    \kern 5pt
    \moveright -5pt\vbox{\hrule width \pagewidth height 1pt}
\fi
  }
  \advancepageno
}
%
\output{\onepageout{\unvbox255}}
%
\def\header{{\SamChe ༄༅\kern.01pt།\hskip2.7em plus .5em minus.5em།}}
\setbox\pghdr=\hbox{\header}
%
\def\titlebox#1{\hbox{\vbox{
\hrule height1pt\hbox{\vrule width1pt\kern4pc\vrule width1pt
\vbox{\kern9pt#1\kern9pt}\vrule width1pt\kern4pc\vrule width1pt}\hrule height1pt}
}}
%
\Sam
